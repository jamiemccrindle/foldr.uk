<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Foldr Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Foldr Blog Atom Feed"><title data-react-helmet="true">Foldr | Foldr</title><meta data-react-helmet="true" property="og:title" content="Foldr | Foldr"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" property="og:url" content="https://foldr.uk/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_posts_list"><link data-react-helmet="true" rel="shortcut icon" href="/img/logo.jpeg"><link data-react-helmet="true" rel="canonical" href="https://foldr.uk/"><link data-react-helmet="true" rel="alternate" href="https://foldr.uk/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://foldr.uk/" hreflang="x-default"><script data-react-helmet="true">function maybeInsertBanner(){window.__DOCUSAURUS_INSERT_BASEURL_BANNER&&insertBanner()}function insertBanner(){var n=document.getElementById("docusaurus-base-url-issue-banner-container");if(n){n.innerHTML='\n<div id="docusaurus-base-url-issue-banner" style="border: thick solid red; background-color: rgb(255, 230, 179); margin: 20px; padding: 20px; font-size: 20px;">\n   <p style="font-weight: bold; font-size: 30px;">Your Docusaurus site did not load properly.</p>\n   <p>A very common reason is a wrong site <a href="https://v2.docusaurus.io/docs/docusaurus.config.js/#baseurl" style="font-weight: bold;">baseUrl configuration</a>.</p>\n   <p>Current configured baseUrl = <span style="font-weight: bold; color: red;">/</span>  (default value)</p>\n   <p>We suggest trying baseUrl = <span id="docusaurus-base-url-issue-banner-suggestion-container" style="font-weight: bold; color: green;"></span></p>\n</div>\n';var e=document.getElementById("docusaurus-base-url-issue-banner-suggestion-container"),s=window.location.pathname,r="/"===s.substr(-1)?s:s+"/";e.innerHTML=r}}window.__DOCUSAURUS_INSERT_BASEURL_BANNER=!0,document.addEventListener("DOMContentLoaded",maybeInsertBanner)</script><link rel="stylesheet" href="/assets/css/styles.9c5a8488.css">
<link rel="preload" href="/assets/js/styles.e8f1afcd.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.17466c6c.js" as="script">
<link rel="preload" href="/assets/js/main.21857e3e.js" as="script">
<link rel="preload" href="/assets/js/common.fb96f332.js" as="script">
<link rel="preload" href="/assets/js/a6aa9e1f.322fe3a4.js" as="script">
<link rel="preload" href="/assets/js/7a85f91c.f5ac933e.js" as="script">
<link rel="preload" href="/assets/js/7827e86e.998c9a8e.js" as="script">
<link rel="preload" href="/assets/js/a5557bb9.812cf378.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div id="docusaurus-base-url-issue-banner-container"></div><div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.jpeg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.jpeg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Foldr</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jamiemccrindle/foldr.uk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://twitter.com/foldr" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.jpeg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.jpeg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Foldr</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/">Blog</a></li><li class="menu__list-item"><a href="https://github.com/jamiemccrindle/foldr.uk" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://twitter.com/foldr" target="_blank" rel="noopener noreferrer" class="menu__link">Twitter</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/terraform-rotate-secrets">Rotate secrets with terraform</a></li></ul></div></div><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/terraform-rotate-secrets">Rotate secrets with terraform</a></h2><div class="margin-vert--md"><time datetime="2021-04-10T00:00:00.000Z" class="blogPostDate_fNvV">April 10, 2021 Â· 2 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/909696?s=60&amp;v=4" alt="Jamie McCrindle"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer">Jamie McCrindle</a></h4><small class="avatar__subtitle">foldr</small></div></div></header><div class="markdown"><p>In this series, I&#x27;ll be using this mechanism to safely rotate Azure Service Principal credentials stored in a GitHub Actions Secret
using terraform.</p><p>In this blog post, I&#x27;ll focus on the secret rotation mechanism in terraform.</p><p>Rotating secrets is a Good Thingâ„¢ as it limits the length of a time a compromised set of credentials can be used for.</p><p>If you do implement secret rotation with a single secret a different challenge is ensuring that the secret
is rotated in the identity provider at the same time as in the services that use the secret or you may have authentication failures.</p><p>The ideal is where the identity provider supports multiple secrets for a single identity e.g. Azure Service Principals. If that&#x27;s
the case, you can have 2 secrets active at the same time and rotate them on offset time periods e.g.:</p><p><img alt="password rotation" src="/assets/images/rotation.drawio-2fa9fba363f4b1f1d7a40b82d61437e2.svg" title="Secret Rotation"></p><p>This mechanism should allow you to pick whatever password expiry window that suits your risk appetite but in this example,
I&#x27;ll work with passwords that are valid 60 days.</p><p>I&#x27;ve set up 2 passwords, one called <code>even</code> and one called <code>odd</code>.</p><p>The <code>odd</code> password rotates at the beginning of the odd months and is the current password for those months i.e.:</p><ul><li>January, March, May, July, September, November</li></ul><p>And the <code>even</code> password rotates at the beginning of the even months and is the current password for those months i.e.:</p><ul><li>February, April, June, August, October, December</li></ul><p>The following is the terraform that acheives this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly terraform"><div tabindex="0" class="prism-code language-terraform codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">locals {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  date        = tonumber(var.date)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  odd_keeper  = floor((local.date + 1) / 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  even_keeper = floor(local.date / 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  use_even    = local.date % 2 == 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;random_password&quot; &quot;odd&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  keepers = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;date&quot; = local.odd_keeper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  length           = 32</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  special          = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  override_special = &quot;_%@&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;random_password&quot; &quot;even&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  keepers = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;date&quot; = local.even_keeper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  length           = 32</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  special          = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  override_special = &quot;_%@&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">output &quot;current_secret&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    value = local.date % 2 == 0 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                ? random_password.even.result </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                : random_password.odd.result</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/terraform">terraform</a><a class="margin-horiz--sm" href="/tags/secrets">secrets</a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Socials</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/foldr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://jamie.mccrindle.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">jamie.mccrindle.org</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Jamie McCrindle. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.e8f1afcd.js"></script>
<script src="/assets/js/runtime~main.17466c6c.js"></script>
<script src="/assets/js/main.21857e3e.js"></script>
<script src="/assets/js/common.fb96f332.js"></script>
<script src="/assets/js/a6aa9e1f.322fe3a4.js"></script>
<script src="/assets/js/7a85f91c.f5ac933e.js"></script>
<script src="/assets/js/7827e86e.998c9a8e.js"></script>
<script src="/assets/js/a5557bb9.812cf378.js"></script>
</body>
</html>