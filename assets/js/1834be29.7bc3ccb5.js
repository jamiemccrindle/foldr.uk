"use strict";(globalThis.webpackChunkfoldr_uk_website=globalThis.webpackChunkfoldr_uk_website||[]).push([[8265],{1712(e,n,t){t.r(n),t.d(n,{contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var o=t(8168),a=(t(6540),t(5680));const r={slug:"claude-code-pro-subscription-docker",title:"How to Use Your Claude Code Pro Subscription in Docker",author:"Jamie McCrindle",author_title:"foldr",author_url:"https://github.com/jamiemccrindle",author_image_url:"https://avatars.githubusercontent.com/u/909696?s=60&v=4",tags:["docker","claude-code","ai","oauth"]},i=void 0,l={permalink:"/claude-code-pro-subscription-docker",editUrl:"https://github.com/jamiemccrindle/foldr.uk/tree/main/foldr-uk-website/blog/blog/2026-01-17-claude-code-pro-subscription-docker.md",source:"@site/blog/2026-01-17-claude-code-pro-subscription-docker.md",title:"How to Use Your Claude Code Pro Subscription in Docker",description:"If you use an API key with Claude Code, you pay for API usage. If you authenticate via OAuth, you use your Pro subscription credits. For those of us who want our subscription to work inside a container, OAuth is the only path.",date:"2026-01-17T00:00:00.000Z",formattedDate:"January 17, 2026",tags:[{label:"docker",permalink:"/tags/docker"},{label:"claude-code",permalink:"/tags/claude-code"},{label:"ai",permalink:"/tags/ai"},{label:"oauth",permalink:"/tags/oauth"}],readingTime:2.465,truncated:!0,nextItem:{title:"Exploiting Visual Studio Code Devcontainers",permalink:"/exploiting-visual-studio-code-devcontainers"}},s=[{value:"The Two Config Locations",id:"the-two-config-locations",children:[]},{value:"Common Pitfalls",id:"common-pitfalls",children:[]},{value:"The Solution",id:"the-solution",children:[]},{value:"First Run",id:"first-run",children:[]},{value:"Debugging Tips",id:"debugging-tips",children:[]}],c={toc:s};function u({components:e,...n}){return(0,a.yg)("wrapper",(0,o.A)({},c,n,{components:e,mdxType:"MDXLayout"}),(0,a.yg)("p",null,"If you use an API key with Claude Code, you pay for API usage. If you authenticate via OAuth, you use your Pro subscription credits. For those of us who want our subscription to work inside a container, OAuth is the only path."),(0,a.yg)("p",null,"The challenge: Claude Code stores state in two locations, and Docker volumes only mount directories, not files. This post shows how to persist both."),(0,a.yg)("h2",{id:"the-two-config-locations"},"The Two Config Locations"),(0,a.yg)("p",null,"Claude Code stores credentials in ",(0,a.yg)("inlineCode",{parentName:"p"},"~/.claude/.credentials.json")," but onboarding state in ",(0,a.yg)("inlineCode",{parentName:"p"},"~/.claude.json"),":"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"/root/\n\u251c\u2500\u2500 .claude/                    \u2190 Directory\n\u2502   \u251c\u2500\u2500 .credentials.json       \u2190 OAuth tokens\n\u2502   \u251c\u2500\u2500 cache/\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 .claude.json                \u2190 Onboarding state (separate file)\n")),(0,a.yg)("p",null,"A named volume on ",(0,a.yg)("inlineCode",{parentName:"p"},"~/.claude")," will persist your credentials, but ",(0,a.yg)("inlineCode",{parentName:"p"},"~/.claude.json")," is ephemeral container storage. Without it, Claude Code triggers the full onboarding flow on every container start."),(0,a.yg)("h2",{id:"common-pitfalls"},"Common Pitfalls"),(0,a.yg)("p",null,"Two issues that will bite you:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},(0,a.yg)("strong",{parentName:"p"},"Entrypoint scripts overwriting credentials.")," If your entrypoint copies a mounted credentials file on every container start, it will overwrite tokens that were refreshed during browser auth. Only copy if the destination doesn't already exist.")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},(0,a.yg)("strong",{parentName:"p"},"Named volumes only mount directories.")," You can't add a single file to a named volume, and bind-mounting a file that doesn't exist yet creates a directory instead. The fix is to symlink the file into a directory that is mounted."))),(0,a.yg)("h2",{id:"the-solution"},"The Solution"),(0,a.yg)("p",null,"Symlink ",(0,a.yg)("inlineCode",{parentName:"p"},"~/.claude.json")," into the persisted directory so one volume covers both locations."),(0,a.yg)("p",null,(0,a.yg)("inlineCode",{parentName:"p"},"Dockerfile")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-dockerfile"},'FROM node:22-bookworm\n\nRUN npm install -g @anthropic-ai/claude-code\n\nRUN echo \'#!/bin/bash\\n\\\nmkdir -p /root/.claude\\n\\\nif [ ! -L /root/.claude.json ]; then\\n\\\n  rm -f /root/.claude.json\\n\\\n  ln -s /root/.claude/claude.json /root/.claude.json\\n\\\nfi\\n\\\nif [ -f /root/.claude-creds ] && [ ! -f /root/.claude/.credentials.json ]; then\\n\\\n  cp /root/.claude-creds /root/.claude/.credentials.json\\n\\\nfi\\n\\\nexec "$@"\' > /entrypoint.sh && chmod +x /entrypoint.sh\n\nWORKDIR /workspace\nENTRYPOINT ["/entrypoint.sh"]\nCMD ["bash"]\n')),(0,a.yg)("p",null,(0,a.yg)("inlineCode",{parentName:"p"},"docker-compose.yml")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-yaml"},"services:\n  claude:\n    build: .\n    stdin_open: true\n    tty: true\n    volumes:\n      - .:/workspace\n      - claude-data:/root/.claude\n      - ~/.claude-container/.credentials.json:/root/.claude-creds:ro\n\nvolumes:\n  claude-data:\n")),(0,a.yg)("h2",{id:"first-run"},"First Run"),(0,a.yg)("p",null,"On first run, you'll need to complete the OAuth flow in your browser once. After that, the authentication state persists in the ",(0,a.yg)("inlineCode",{parentName:"p"},"claude-data")," volume."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-shell"},"docker compose run claude claude\n")),(0,a.yg)("div",{className:"admonition admonition-info alert alert--info"},(0,a.yg)("div",{parentName:"div",className:"admonition-heading"},(0,a.yg)("h5",{parentName:"div"},(0,a.yg)("span",{parentName:"h5",className:"admonition-icon"},(0,a.yg)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.yg)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,a.yg)("div",{parentName:"div",className:"admonition-content"},(0,a.yg)("p",{parentName:"div"},"The credentials file at ",(0,a.yg)("inlineCode",{parentName:"p"},"~/.claude-container/.credentials.json")," is only used for initial bootstrap. After your first browser authentication, the container will use the tokens stored in the named volume."))),(0,a.yg)("h2",{id:"debugging-tips"},"Debugging Tips"),(0,a.yg)("p",null,"If authentication isn't persisting:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("inlineCode",{parentName:"li"},"docker exec")," into a running container where auth works"),(0,a.yg)("li",{parentName:"ol"},"Check what files exist in ",(0,a.yg)("inlineCode",{parentName:"li"},"/root/.claude/")," and whether ",(0,a.yg)("inlineCode",{parentName:"li"},"/root/.claude.json")," is a symlink"),(0,a.yg)("li",{parentName:"ol"},"Look for ",(0,a.yg)("inlineCode",{parentName:"li"},"hasCompletedOnboarding")," in the json files to see which one stores onboarding state")),(0,a.yg)("p",null,"This generalises to any app that scatters state across multiple locations. Before building persistence, ",(0,a.yg)("inlineCode",{parentName:"p"},'find ~ -name "*appname*"')," helps map where everything lands."),(0,a.yg)("hr",null),(0,a.yg)("p",null,"I debugged this with Claude Code running on my host machine while another instance ran inside the container, passing messages between them manually. A bit like ",(0,a.yg)("em",{parentName:"p"},"Severance"),"\u2014the innie helping debug its own persistence issues while the outie ran commands from the outside."))}u.isMDXComponent=!0},5680(e,n,t){t.d(n,{xA:()=>u,yg:()=>g});var o=t(6540);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach(function(n){a(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function l(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=o.createContext({}),c=function(e){var n=o.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=c(e.components);return o.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},p=o.forwardRef(function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(t),g=a,m=p["".concat(s,".").concat(g)]||p[g]||d[g]||r;return t?o.createElement(m,i(i({ref:n},u),{},{components:t})):o.createElement(m,i({ref:n},u))});function g(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,i=new Array(r);i[0]=p;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var c=2;c<r;c++)i[c]=t[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}p.displayName="MDXCreateElement"}}]);