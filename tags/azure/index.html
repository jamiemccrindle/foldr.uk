<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Jamie McCrindle Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Jamie McCrindle Blog Atom Feed"><title data-react-helmet="true">Posts tagged &quot;azure&quot; | Jamie McCrindle</title><meta data-react-helmet="true" property="og:title" content="Posts tagged &quot;azure&quot; | Jamie McCrindle"><meta data-react-helmet="true" name="description" content="Blog | Tagged &quot;azure&quot;"><meta data-react-helmet="true" property="og:description" content="Blog | Tagged &quot;azure&quot;"><meta data-react-helmet="true" property="og:url" content="https://foldr.uk/tags/azure"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="shortcut icon" href="/img/logo.jpeg"><link data-react-helmet="true" rel="canonical" href="https://foldr.uk/tags/azure"><link data-react-helmet="true" rel="alternate" href="https://foldr.uk/tags/azure" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://foldr.uk/tags/azure" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.9c5a8488.css">
<link rel="preload" href="/assets/js/styles.f3635bff.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.ca9e8b86.js" as="script">
<link rel="preload" href="/assets/js/main.8ef49b02.js" as="script">
<link rel="preload" href="/assets/js/1.ceca3878.js" as="script">
<link rel="preload" href="/assets/js/2.8ae529b6.js" as="script">
<link rel="preload" href="/assets/js/6875c492.1ea87412.js" as="script">
<link rel="preload" href="/assets/js/7a85f91c.e40a6c51.js" as="script">
<link rel="preload" href="/assets/js/9c7135ba.c3a918c0.js" as="script">
<link rel="preload" href="/assets/js/0fa500f8.fa89d354.js" as="script">
<link rel="preload" href="/assets/js/a3bc796e.08bb3a3f.js" as="script">
<link rel="preload" href="/assets/js/ef31134d.1cd136a9.js" as="script">
<link rel="preload" href="/assets/js/708a5a2f.a3a077f1.js" as="script">
<link rel="preload" href="/assets/js/e6f0bbcb.c78a953c.js" as="script">
<link rel="preload" href="/assets/js/24fa647e.7f4bcede.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Jamie McCrindle</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://twitter.com/foldr" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter</a><div class="react-toggle react-toggle--checked react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" checked="" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Jamie McCrindle</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/">Blog</a></li><li class="menu__list-item"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://twitter.com/foldr" target="_blank" rel="noopener noreferrer" class="menu__link">Twitter</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/exploiting-visual-studio-code-devcontainers">Exploiting Visual Studio Code Devcontainers</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/azure-app-service-devcontainer">Running a devcontainer in an Azure App Service</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/azure-bicep-app-service-custom-container">Building an Azure App Service with a custom container using Bicep</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/github-actions-schedule-to-delete-resources-from-resource-group">Keep your Azure Costs low by removing dev resources from resource groups on a schedule.</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/rotating-azure-credentials-in-github-with-terraform">How to rotate your AZURE_CREDENTIALS in GitHub with Terraform</a></li></ul></div></div><main class="col col--7"><h1>6 posts tagged with &quot;azure&quot;</h1><a href="/tags">View All Tags</a><div class="margin-vert--xl"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/azure-app-service-devcontainer">Running a devcontainer in an Azure App Service</a></h2><div class="margin-vert--md"><time datetime="2021-06-01T00:00:00.000Z" class="blogPostDate_fNvV">June 1, 2021 Â· 4 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/909696?s=60&amp;v=4" alt="Jamie McCrindle"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer">Jamie McCrindle</a></h4><small class="avatar__subtitle">foldr</small></div></div></header><div class="markdown"><p>I love Visual Studio Code devcontainers. I was curious if you could use an App Service with a custom container as a remote devcontainer.</p><p>What follows are instructions on how to get a remote devcontainer running in an App Service over SSH.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>note</h5></div><div class="admonition-content"><p>While this does appear to work, it seems a little fragile. The connection times out sporadically and I haven&#x27;t used it to do development in earnest yet, so caveat emptor.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="creating-an-app-service-compatible-devcontainer-image"></a>Creating an app service compatible devcontainer image<a class="hash-link" href="#creating-an-app-service-compatible-devcontainer-image" title="Direct link to heading">#</a></h2><p>In order to connect to your app service devcontainer via, you&#x27;ll need to configure it&#x27;s sshd as documented in the <a href="https://docs.microsoft.com/en-us/azure/app-service/configure-custom-container?pivots=container-linux#detect-https-session" target="_blank" rel="noopener noreferrer">Configure a custom container for Azure App Service</a> guide from Microsoft.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sshd_config"><div tabindex="0" class="prism-code language-sshd_config codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Port 2222</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ListenAddress 0.0.0.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LoginGraceTime 180</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">X11Forwarding yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Ciphers aes128-cbc,3des-cbc,aes256-cbc,aes128-ctr,aes192-ctr,aes256-ctr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">MACs hmac-sha1,hmac-sha1-96</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">StrictModes yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SyslogFacility DAEMON</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">PasswordAuthentication yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">PermitEmptyPasswords no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">PermitRootLogin yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Subsystem sftp internal-sftp</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In addition to the devcontainer setup, you&#x27;ll need to add add some additional configuration to your image for it to work in an app service. Specifically you&#x27;ll need to:</p><ul><li>Add your sshd_config</li><li>Set the root password to Docker! Yes, this does feel wrong but it&#x27;s inaccessible unless you use an Azure AD authenticated tunnel.</li><li>Add a webserver for the app service to host, in this case I&#x27;m using nginx</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly dockerfile"><div tabindex="0" class="prism-code language-dockerfile codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># use the default microsoft dotnet 5 devcontainer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">FROM mcr.microsoft.com/vscode/devcontainers/dotnetcore:0-5.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># add required packages including openssh-server and nginx</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RUN apt-get update \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &amp;&amp; apt-get -y install --no-install-recommends apt-transport-https curl ca-certificates lsb-release gnupg2 openssh-server nginx</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RUN echo &quot;root:Docker!&quot; | chpasswd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Copy the sshd_config file to the /etc/ssh/ directory</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">COPY sshd_config /etc/ssh/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Open port 2222 for SSH access</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EXPOSE 80 2222</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Start up nginx and ssh and then sleep to keep the container alive</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CMD /usr/sbin/service nginx start &amp;&amp; /usr/sbin/service ssh start &amp;&amp; /usr/bin/sleep infinity</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="connecting-to-your-devcontainer"></a>Connecting to your devcontainer<a class="hash-link" href="#connecting-to-your-devcontainer" title="Direct link to heading">#</a></h2><p>First, you&#x27;ll need to create a tunnel to your app service devcontainer using the following command. Include the -p option to select a fixed port as this will make it easier to connect in future.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">az webapp create-remote-connection --resource-group RESOURCE_GROUP_NAME -n APP_SERVICE_NAME -p </span><span class="token number" style="color:rgb(247, 140, 108)">61000</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Visual Studio requires that you use a key based authentication. Copy your ssh public key to your devcontainer using the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># if you&#x27;re on windows, use git bash for this</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh-copy-id -i ~/.ssh/id_rsa.pub -p </span><span class="token number" style="color:rgb(247, 140, 108)">61000</span><span class="token plain"> root@localhost</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To be able to pull from your git repository over ssh, you&#x27;ll want to use an ssh-agent and ssh-agent forwarding. On windows, you can start your ssh-agent with the following command in a PowerShell session running as Administrator</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly PowerShell"><div tabindex="0" class="prism-code language-PowerShell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">start-ssh-agent.cmd</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Install the <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-ssh" target="_blank" rel="noopener noreferrer">Remote - SSH</a> Visual Studio Code Extension.</p><p>Once it&#x27;s installed, click the Remote Explorer icon on the left side of your Visual Studio Code window and click the + button to add a new SSH connection.</p><p>Type in <code>ssh -A root@localhost -p 61000</code></p><p>Then right click on the new <code>localhost</code> target in the list and click <code>Connect to Host in New Window</code></p><p>Once you&#x27;re connected, open up a terminal window and run:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> /workspaces</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> /workspaces</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone SSH_URL_FOR_YOUR_REPOSITORY</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Then click Open Folder on the left and selected /workspaces/NAME_OF_YOUR_REPO and you should be good to go.</p><p>To see a working example of the setup, have a look at <a href="https://github.com/jamiemccrindle/bicep-app-service-container" target="_blank" rel="noopener noreferrer">https://github.com/jamiemccrindle/bicep-app-service-container</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-much-will-this-cost"></a>How much will this cost?<a class="hash-link" href="#how-much-will-this-cost" title="Direct link to heading">#</a></h2><p>I&#x27;ve picked a relatively snappy P1v3 which has 2 cores and 8GB of RAM. Assuming a working year of approximately 48 weeks, working for 5 days a week with the machine running for half the day, a devcontainer running in an app service would cost Â£30.95 per developer.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="troubleshooting"></a>Troubleshooting<a class="hash-link" href="#troubleshooting" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="my-app-service-has-restarted-and-i-cant-connect"></a>My app service has restarted and I can&#x27;t connect<a class="hash-link" href="#my-app-service-has-restarted-and-i-cant-connect" title="Direct link to heading">#</a></h3><p>If your app service restarts, you&#x27;ll need to copy your public ssh key again. Also, you&#x27;ll have an old entry in your known_hosts file. If you try and ssh into your machine you&#x27;ll see this delightful message:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">ssh</span><span class="token plain"> root@localhost -p </span><span class="token number" style="color:rgb(247, 140, 108)">61000</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">     @</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Someone could be eavesdropping on you right now </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">man-in-the-middle attack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">It is also possible that a </span><span class="token function" style="color:rgb(130, 170, 255)">host</span><span class="token plain"> key has just been changed.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Simply delete the offending line from your known hosts file. You could also switch off host key checking using <code>StrictHostKeyChecking no</code> and <code>UserKnownHostsFile /dev/null</code> in your ssh config file but you&#x27;d potentially open yourself up to man-in-the-middle attacks.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="im-having-trouble-getting-ssh-and-visual-studio-code-working-together"></a>I&#x27;m having trouble getting SSH and Visual Studio Code working together<a class="hash-link" href="#im-having-trouble-getting-ssh-and-visual-studio-code-working-together" title="Direct link to heading">#</a></h3><p>Have a look here:</p><ul><li><a href="https://code.visualstudio.com/docs/remote/ssh" target="_blank" rel="noopener noreferrer">https://code.visualstudio.com/docs/remote/ssh</a></li><li><a href="https://code.visualstudio.com/docs/remote/troubleshooting#_ssh-tips" target="_blank" rel="noopener noreferrer">https://code.visualstudio.com/docs/remote/troubleshooting#_ssh-tips</a></li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/azure">azure</a><a class="margin-horiz--sm" href="/tags/bicep">bicep</a><a class="margin-horiz--sm" href="/tags/app-service">app-service</a><a class="margin-horiz--sm" href="/tags/docker">docker</a><a class="margin-horiz--sm" href="/tags/devcontainer">devcontainer</a></div><div class="col text--right"><a aria-label="Read more about Running a devcontainer in an Azure App Service" href="/azure-app-service-devcontainer"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/azure-bicep-app-service-custom-container">Building an Azure App Service with a custom container using Bicep</a></h2><div class="margin-vert--md"><time datetime="2021-05-30T00:00:00.000Z" class="blogPostDate_fNvV">May 30, 2021 Â· 3 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/909696?s=60&amp;v=4" alt="Jamie McCrindle"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer">Jamie McCrindle</a></h4><small class="avatar__subtitle">foldr</small></div></div></header><div class="markdown"><p>Azure App Service with custom containers is a convenient way to host docker containers in Azure. While there
are a number of tutorials on how to do this with <code>az cli</code> there aren&#x27;t too many that show how to do it with
ARM templates or Azure Bicep. Read on to see how to set up an Azure Container Registry, create scope maps and scope mapped tokens, build and push a custom image and finally use that custom image in your Azure App Service.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="first-a-word-on-scope-maps-and-tokens"></a>First, a word on scope maps and tokens<a class="hash-link" href="#first-a-word-on-scope-maps-and-tokens" title="Direct link to heading">#</a></h2><p>Azure Container Registry has a number of authentication mechanisms for pulling docker images. The only one that lets you limit access to specific docker images are <a href="https://docs.microsoft.com/en-us/azure/container-registry/container-registry-repository-scoped-permissions" target="_blank" rel="noopener noreferrer">scoped mapped tokens</a> which is why I&#x27;m going to use them in this example.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Scope Maps and Scope Map Tokens are currently in preview, so use with caution in production.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-your-acr"></a>Setting up your ACR<a class="hash-link" href="#setting-up-your-acr" title="Direct link to heading">#</a></h2><p>You&#x27;ll need a Container Registry to host your custom container. The following bicep sets up a Premium Azure Container Registry. The reason I&#x27;m using a Premium SKU is so that I can create scoped maps and scope mapped tokens.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bicep"><div tabindex="0" class="prism-code language-bicep codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param location string = resourceGroup().location</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource acr &#x27;Microsoft.ContainerRegistry/registries@2019-12-01-preview&#x27; = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name: acrName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  location: location</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sku: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: &#x27;Premium&#x27; // to support scope mapped tokens</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  properties: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    adminUserEnabled: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You may also want to assign an owner to your ACR</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bicep"><div tabindex="0" class="prism-code language-bicep codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param ownerPrincipalId string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource ownerRoleAssignment &#x27;Microsoft.Authorization/roleAssignments@2018-01-01-preview&#x27; = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name: guid(&#x27;${acr.id}/${ownerPrincipalId}/owner&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  scope: acr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  properties: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    roleDefinitionId: &#x27;/subscriptions/${subscription().subscriptionId}/providers/Microsoft.Authorization/roleDefinitions/8e3af657-a8ff-443c-a75c-2fe8c4bcb635&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    principalId: ownerPrincipalId</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>And set up your scope maps and scope mapped tokens</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bicep"><div tabindex="0" class="prism-code language-bicep codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// create a scope map for your repository</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource bicepAppServiceContainerScopeMap &#x27;Microsoft.ContainerRegistry/registries/scopeMaps@2020-11-01-preview&#x27; = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  parent: acr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name: &#x27;bicepAppServiceContainer&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  properties: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    actions: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;repositories/bicep-app-service-container/content/read&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;repositories/bicep-app-service-container/metadata/read&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// create a token and associate it with your scope map</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource bicepAppServiceContainerToken &#x27;Microsoft.ContainerRegistry/registries/tokens@2020-11-01-preview&#x27; = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  parent: acr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name: &#x27;bicepAppServiceContainer&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  properties: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    scopeMapId: bicepAppServiceContainerScopeMap.id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    status: &#x27;enabled&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="generating-passwords-for-your-tokens"></a>Generating passwords for your tokens<a class="hash-link" href="#generating-passwords-for-your-tokens" title="Direct link to heading">#</a></h2><p>The bicep above will create the scope map tokens but will not generate the passwords. You&#x27;ll need <code>az cli</code> for that.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ACR_PULL_TOKEN</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable" style="color:rgb(191, 199, 213)">az acr token credential generate -n bicepAppServiceContainer -r $ACR_NAME --expiration-in-days </span><span class="token variable number" style="color:rgb(247, 140, 108)">30</span><span class="token variable" style="color:rgb(191, 199, 213)"> --query passwords</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token variable number" style="color:rgb(247, 140, 108)">0</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token variable" style="color:rgb(191, 199, 213)">.value -o tsv</span><span class="token variable" style="color:rgb(191, 199, 213)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This will generate the passwords and set ACR_PULL_TOKEN to be the value of one of the generated passwords.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-your-app-service-with-a-custom-container"></a>Setting up your App Service with a Custom Container<a class="hash-link" href="#setting-up-your-app-service-with-a-custom-container" title="Direct link to heading">#</a></h2><p>Use the bicep below to create a linux App Service plan and an App Service that uses your custom container.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bicep"><div tabindex="0" class="prism-code language-bicep codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@description(&#x27;The name of the app service that you wish to create.&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">param siteName string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@description(&#x27;The docker registry hostname.&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">param dockerRegistryHost string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@description(&#x27;The docker registry username.&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">param dockerUsername string;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@secure()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@description(&#x27;The docker registry password.&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">param dockerPassword string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@description(&#x27;The relative docker image name.&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">param dockerImage string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var servicePlanName = &#x27;plan-${siteName}-001&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource servicePlan &#x27;Microsoft.Web/serverfarms@2016-09-01&#x27; = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  kind: &#x27;linux&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name: servicePlanName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  location: resourceGroup().location</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  properties: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: servicePlanName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    reserved: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sku: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    tier: &#x27;Standard&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: &#x27;S1&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  dependsOn: []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource siteName_resource &#x27;Microsoft.Web/sites@2016-08-01&#x27; = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name: siteName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  location: resourceGroup().location</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  properties: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    siteConfig: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      appSettings: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          name: &#x27;WEBSITES_ENABLE_APP_SERVICE_STORAGE&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          value: &#x27;false&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          name: &#x27;DOCKER_REGISTRY_SERVER_URL&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          value: &#x27;https://${dockerRegistryHost}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          name: &#x27;DOCKER_REGISTRY_SERVER_USERNAME&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          value: dockerUsername</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          name: &#x27;DOCKER_REGISTRY_SERVER_PASSWORD&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          value: dockerPassword</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      linuxFxVersion: &#x27;DOCKER|${dockerRegistryHost}/${dockerImage}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    serverFarmId: servicePlan.id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To see a working example, have a look at the following repository <a href="https://github.com/jamiemccrindle/bicep-app-service-container" target="_blank" rel="noopener noreferrer">https://github.com/jamiemccrindle/bicep-app-service-container</a></p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/azure">azure</a><a class="margin-horiz--sm" href="/tags/bicep">bicep</a><a class="margin-horiz--sm" href="/tags/app-service">app-service</a><a class="margin-horiz--sm" href="/tags/docker">docker</a></div><div class="col text--right"><a aria-label="Read more about Building an Azure App Service with a custom container using Bicep" href="/azure-bicep-app-service-custom-container"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/github-actions-schedule-to-delete-resources-from-resource-group">Keep your Azure Costs low by removing dev resources from resource groups on a schedule.</a></h2><div class="margin-vert--md"><time datetime="2021-05-30T00:00:00.000Z" class="blogPostDate_fNvV">May 30, 2021 Â· 2 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/909696?s=60&amp;v=4" alt="Jamie McCrindle"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer">Jamie McCrindle</a></h4><small class="avatar__subtitle">foldr</small></div></div></header><div class="markdown"><p>I have a Visual Studio subscription that gives me Â£40.00 of Azure Credit each month to experiment in Azure. I find it relatively easy to spend this if I&#x27;m not careful about deleting resources after I&#x27;ve spun them up. Fortunately, I can use a GitHub Actions workflow on a schedule to save me when I forget.</p><p>I usually associate a set of resource groups with a repository in GitHub. I have a couple of options, I could delete the resource groups themselves or I could delete the resources in the resource groups. In this example, I&#x27;ve chosen just to delete the resources.</p><p>To do this, I use <code>complete</code> mode with an empty ARM template:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;$schema&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;contentVersion&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;1.0.0.0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;resources&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The GitHub Action then looks as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> destroy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">schedule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">cron</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0 0 * * *&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># add workflow dispatch to be able to run trigger the workflow manually</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">workflow_dispatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">jobs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">destroy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">runs-on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">latest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Azure Login</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> azure/login@v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">with</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">creds</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> secrets.AZURE_CREDENTIALS </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> actions/checkout@v2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Destroy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> deploy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">acr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> azure/CLI@v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">with</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">azcliversion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 2.23.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">inlineScript</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">          az deployment group create --name destroy --resource-group NAME_OF_YOUR_RESOURCE_GROUP --template-file .github/workflows/empty.json --mode Complete</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Check out the the following repo for a working example: <a href="https://github.com/jamiemccrindle/bicep-app-service-container" target="_blank" rel="noopener noreferrer">https://github.com/jamiemccrindle/bicep-app-service-container</a></p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/azure">azure</a><a class="margin-horiz--sm" href="/tags/github">github</a><a class="margin-horiz--sm" href="/tags/github-actions">github-actions</a></div><div class="col text--right"><a aria-label="Read more about Keep your Azure Costs low by removing dev resources from resource groups on a schedule." href="/github-actions-schedule-to-delete-resources-from-resource-group"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/rotating-azure-credentials-in-github-with-terraform">How to rotate your AZURE_CREDENTIALS in GitHub with Terraform</a></h2><div class="margin-vert--md"><time datetime="2021-04-28T00:00:00.000Z" class="blogPostDate_fNvV">April 28, 2021 Â· 3 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/909696?s=60&amp;v=4" alt="Jamie McCrindle"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer">Jamie McCrindle</a></h4><small class="avatar__subtitle">foldr</small></div></div></header><div class="markdown"><p>If you&#x27;re deploying your Azure infrastructure from GitHub, you&#x27;ll need Azure service principal credentials stored as secret variables.
You may also want to rotate those credentials. This entry describes how you can use Terraform in your GitHub actions to configure
and rotate your Azure service principal credentials.</p><p>In a <a href="https://foldr.uk/terraform-rotate-secrets" target="_blank" rel="noopener noreferrer">previous post, I describe how to safely rotate credentials using Terraform</a>. This post
builds on that by showing you how to create client secrets for your Azure service principals and store them as secrets in GitHub.</p><p>First off, we&#x27;ll create a Terraform module that will manage the secret rotation in Azure and GitHub. This stores everything you need
to be able to deploy from GitHub to Azure, including information about the credentials, service principal, tenant and subscription.</p><p>It stores them both as an AZURE_CREDENTIALS json block that matches the output of <code>az ad sp create-for-rbac --sdk-auth</code> which is
useful for the <a href="https://github.com/marketplace/actions/azure-login" target="_blank" rel="noopener noreferrer">Azure Login GitHub Action</a> under the variable AZURE_CREDENTIALS
as well as broken out into ARM_CLIENT_ID, ARM_TENANT_ID, ARM_SUBSCRIPTION_ID and ARM_CLIENT_SECRET which is useful for running
Terraform in GitHub Actions.</p><p>The format of the sdk-auth that the Azure Login GitHub Action requires is as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;clientId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;APPLICATION_ID&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;clientSecret&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;CLIENT_SECRET&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;subscriptionId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SUBSCRIPTION_ID&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;tenantId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;TENANT_ID&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;activeDirectoryEndpointUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://login.microsoftonline.com&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;resourceManagerEndpointUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://management.azure.com/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;activeDirectoryGraphResourceId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://graph.windows.net/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;sqlManagementEndpointUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://management.core.windows.net:8443/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;galleryEndpointUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://gallery.azure.com/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;managementEndpointUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://management.core.windows.net/&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The following files will create a Terraform module that will allow you to safely rotate secrets in Azure and store the currently
active secret in GitHub secrets for use in GitHub Actions:</p><p><code>provider.tf</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><div tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">provider &quot;azurerm&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  features {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>variables.tf</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><div tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;subscription_id&quot; { type = string }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;tenant_id&quot; { type = string }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;repository&quot; { type = string }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;application_id&quot; { type = string }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;application_object_id&quot; { type = string }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;date&quot; { type = string }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>main.tf</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><div tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">locals {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  date        = tonumber(var.date)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  odd_keeper  = floor((local.date + 1) / 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  even_keeper = floor(local.date / 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  use_even    = local.date % 2 == 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;random_uuid&quot; &quot;odd&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;azuread_application_password&quot; &quot;odd&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  application_object_id = var.application_object_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description           = &quot;odd&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  value                 = random_password.odd.result</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end_date_relative     = &quot;1440h&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  key_id                = random_uuid.odd.result</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;random_password&quot; &quot;odd&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  keepers = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;date&quot; = local.odd_keeper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  length  = 64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;random_uuid&quot; &quot;even&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;azuread_application_password&quot; &quot;even&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  application_object_id = var.application_object_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description           = &quot;even&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  value                 = random_password.even.result</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end_date_relative     = &quot;1440h&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  key_id                = random_uuid.even.result</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;random_password&quot; &quot;even&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  keepers = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;date&quot; = local.even_keeper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  length  = 64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;github_actions_secret&quot; &quot;terraform&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  repository      = var.repository</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name     = &quot;AZURE_CREDENTIALS&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  plaintext_value = &lt;&lt;-EOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;clientId&quot;: &quot;${var.application_id}&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;clientSecret&quot;: &quot;${local.use_even ? random_password.even.result : random_password.odd.result}&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;subscriptionId&quot;: &quot;${var.subscription_id}&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;tenantId&quot;: &quot;${var.tenant_id}&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;activeDirectoryEndpointUrl&quot;: &quot;https://login.microsoftonline.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;resourceManagerEndpointUrl&quot;: &quot;https://management.azure.com/&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;activeDirectoryGraphResourceId&quot;: &quot;https://graph.windows.net/&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;sqlManagementEndpointUrl&quot;: &quot;https://management.core.windows.net:8443/&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;galleryEndpointUrl&quot;: &quot;https://gallery.azure.com/&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;managementEndpointUrl&quot;: &quot;https://management.core.windows.net/&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;github_actions_secret&quot; &quot;arm_client_id&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  repository = var.repository</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name = &quot;ARM_CLIENT_ID&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  plaintext_value = var.application_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;github_actions_secret&quot; &quot;arm_client_secret&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  repository = var.repository</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name = &quot;ARM_CLIENT_SECRET&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  plaintext_value = local.use_even ? random_password.even.result : random_password.odd.result</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;github_actions_secret&quot; &quot;arm_subscription_id&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  repository = var.repository</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name = &quot;ARM_SUBSCRIPTION_ID&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  plaintext_value = var.subscription_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;github_actions_secret&quot; &quot;arm_tenant_id&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  repository = var.repository</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name = &quot;ARM_TENANT_ID&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  plaintext_value = var.tenant_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-the-module"></a>Using the module<a class="hash-link" href="#using-the-module" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><div tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">module &quot;example_github_azure&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  source                = &quot;LOCATION_OF_MODULE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  subscription_id       = AZURE_SUBSCRIPTION_ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  tenant_id             = AZURE_TENANT_ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  repository            = GITHUB_REPO_NAME</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  application_id        = AZURE_APPLICATION_ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  application_object_id = AZURE_APPLICATION_OBJECT_ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  date                  = var.date</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To see it in action, have a look at this repository <a href="https://github.com/jamiemccrindle/azure-rotate-service-principal-github-secrets" target="_blank" rel="noopener noreferrer">https://github.com/jamiemccrindle/azure-rotate-service-principal-github-secrets</a></p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/terraform">terraform</a><a class="margin-horiz--sm" href="/tags/azure">azure</a><a class="margin-horiz--sm" href="/tags/github">github</a></div><div class="col text--right"><a aria-label="Read more about How to rotate your AZURE_CREDENTIALS in GitHub with Terraform" href="/rotating-azure-credentials-in-github-with-terraform"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/microsoft-graph-terraform-data-source">Microsoft Graph API Terraform Data Source</a></h2><div class="margin-vert--md"><time datetime="2021-04-19T00:00:00.000Z" class="blogPostDate_fNvV">April 19, 2021 Â· 2 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/909696?s=60&amp;v=4" alt="Jamie McCrindle"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer">Jamie McCrindle</a></h4><small class="avatar__subtitle">foldr</small></div></div></header><div class="markdown"><p>Most Terraform examples that reference permissions from the Microsoft Graph use the GUIDs for the permissions. This makes
it harder to write the Terraform config, as you have to look up the GUIDs for each permission. It also makes it harder
to do code reviews where reviewers typically just believe the comment that describes what permission the GUID represents.</p><p>This is what the code for the required_resource_access for an azure ad application for k8s looks like using just the GUIDs
(this is from a real example online):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><div tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">required_resource_access {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  resource_app_id = &quot;00000003-0000-0000-c000-000000000000&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  resource_access {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id   = &quot;7ab1d382-f21e-4acd-a863-ba3e13f7da61&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;Role&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  resource_access {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id   = &quot;06da0dbc-49e2-44d2-8312-53f166ab848a&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;Scope&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  resource_access {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id   = &quot;e1fe6dd8-ba31-4d61-89e7-88639da4683d&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;Scope&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Your AD tenant should have enterprise applications (service principals) for the various Microsoft services including
the Microsoft Graph.</p><p><img alt="Microsoft Graph Enterprise Application" src="/assets/images/enterprise-applications-05e63a1d48cebcbf37a8241215dcf691.png"></p><p>You can look this up as a data source using Terraform as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><div tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">data &quot;azuread_service_principal&quot; &quot;graph&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    # graph api application id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    application_id = &quot;00000003-0000-0000-c000-000000000000&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This will return a data source that has all of the oauth2 permissions and app roles for the Microsoft Graph. They can be awkward to
work with, so I&#x27;ll usually create a new object that maps the permission name to the permission id e.g.:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><div tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">locals {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    graph = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        application_id = data.azuread_service_principal.graph.application_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        app_roles = {for app_role in data.azuread_service_principal.graph.app_roles : app_role.value =&gt; app_role.id}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        oauth2_permissions = {for oauth2_permission in data.azuread_service_principal.graph.oauth2_permissions : oauth2_permission.value =&gt; oauth2_permission.id}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Using this, the example above would look like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><div tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">required_resource_access {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  resource_app_id = local.graph.application_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  resource_access {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id   = local.graph.app_roles[&quot;Directory.Read.All&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;Role&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  resource_access {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id   = local.graph.oauth2_permissions[&quot;Directory.Read.All&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;Scope&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  resource_access {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id   = local.graph.oauth2_permissions[&quot;User.Read&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;Scope&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Note: this works for more than just the Microsoft Graph, you can use the same technique to look up app roles and permissions from any of your
enterprise applications.</p></div></div></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/terraform">terraform</a><a class="margin-horiz--sm" href="/tags/azure">azure</a></div><div class="col text--right"><a aria-label="Read more about Microsoft Graph API Terraform Data Source" href="/microsoft-graph-terraform-data-source"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/bootstrap-terraform-state-in-azure">Bootstrap terraform state in azure</a></h2><div class="margin-vert--md"><time datetime="2021-04-18T00:00:00.000Z" class="blogPostDate_fNvV">April 18, 2021 Â· 2 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/909696?s=60&amp;v=4" alt="Jamie McCrindle"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer">Jamie McCrindle</a></h4><small class="avatar__subtitle">foldr</small></div></div></header><div class="markdown"><p>It&#x27;s a good idea to store your Terraform state in a remote backend because:</p><ul><li>Terraform state often contains sensitive information e.g. credentials, access tokens etc. so using a backend that has access control and encrypts the state at rest and in transit will keep it safer.</li><li>Your Terraform state can be backed up</li><li>You can retrieve your state when running scripts in CI / CD pipelines.</li></ul><p>If you&#x27;re using Terraform to configure Azure resources, you&#x27;ll probably want to use the <a href="https://www.terraform.io/docs/language/settings/backends/azurerm.html" target="_blank" rel="noopener noreferrer">azurerm terraform backend</a>.</p><p>This stores your state in an Azure Storage Account. The following Terraform will create a storage account that can be used to store your Terraform state in Azure:</p><p><code>main.tf</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><div tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;azurerm_resource_group&quot; &quot;terraform_state&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name     = var.resource_group_name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  location = var.location</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;azurerm_storage_account&quot; &quot;terraform_state&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name                     = var.storage_account_name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  resource_group_name      = azurerm_resource_group.terraform_state.name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  location                 = azurerm_resource_group.terraform_state.location</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  account_tier             = &quot;Standard&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  account_replication_type = &quot;GRS&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  min_tls_version          = &quot;TLS1_2&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;azurerm_storage_container&quot; &quot;terraform_state&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name                  = var.container_name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  storage_account_name  = azurerm_storage_account.terraform_state.name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  container_access_type = &quot;private&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;resource_group_name&quot; { type = string }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;storage_account_name&quot; { type = string }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;container_name&quot; { type = string }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;location&quot; { type = string }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To run it, you&#x27;ll need to supply a file with the following variables set:</p><p><code>bootstrap.tfvars</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><div tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the name of the resource group</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># e.g. &quot;rg-mytfstate-shared-001&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource_group_name = &quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the name of the storage account</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># e.g. &quot;sttfstate001&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">storage_account_name = &quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the name of the container</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># e.g. &quot;tfstate&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">container_name = &quot;tfstate&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the location of the resouce group </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># and storage account e.g. &quot;West Europe&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">location = &quot;West Europe&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To apply the terraform run the following</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># log into azure, this assumes you have sufficient </span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># privileges to create resource groups</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">az login</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># initialise terraform</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">terraform init</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># show a plan</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">terraform plan -var-file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">bootstrap.tfvars</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># apply the terraform</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">terraform apply -var-file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">bootstrap.tfvars</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/terraform">terraform</a><a class="margin-horiz--sm" href="/tags/azure">azure</a></div><div class="col text--right"><a aria-label="Read more about Bootstrap terraform state in azure" href="/bootstrap-terraform-state-in-azure"><strong>Read More</strong></a></div></footer></article></div></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Socials</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/foldr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://jamie.mccrindle.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">jamie.mccrindle.org</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Jamie McCrindle. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.f3635bff.js"></script>
<script src="/assets/js/runtime~main.ca9e8b86.js"></script>
<script src="/assets/js/main.8ef49b02.js"></script>
<script src="/assets/js/1.ceca3878.js"></script>
<script src="/assets/js/2.8ae529b6.js"></script>
<script src="/assets/js/6875c492.1ea87412.js"></script>
<script src="/assets/js/7a85f91c.e40a6c51.js"></script>
<script src="/assets/js/9c7135ba.c3a918c0.js"></script>
<script src="/assets/js/0fa500f8.fa89d354.js"></script>
<script src="/assets/js/a3bc796e.08bb3a3f.js"></script>
<script src="/assets/js/ef31134d.1cd136a9.js"></script>
<script src="/assets/js/708a5a2f.a3a077f1.js"></script>
<script src="/assets/js/e6f0bbcb.c78a953c.js"></script>
<script src="/assets/js/24fa647e.7f4bcede.js"></script>
</body>
</html>