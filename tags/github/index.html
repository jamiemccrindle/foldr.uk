<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Jamie McCrindle Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Jamie McCrindle Blog Atom Feed"><title data-react-helmet="true">Posts tagged &quot;github&quot; | Jamie McCrindle</title><meta data-react-helmet="true" property="og:title" content="Posts tagged &quot;github&quot; | Jamie McCrindle"><meta data-react-helmet="true" name="description" content="Blog | Tagged &quot;github&quot;"><meta data-react-helmet="true" property="og:description" content="Blog | Tagged &quot;github&quot;"><meta data-react-helmet="true" property="og:url" content="https://foldr.uk/tags/github"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="shortcut icon" href="/img/logo.jpeg"><link data-react-helmet="true" rel="canonical" href="https://foldr.uk/tags/github"><link data-react-helmet="true" rel="alternate" href="https://foldr.uk/tags/github" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://foldr.uk/tags/github" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.9c5a8488.css">
<link rel="preload" href="/assets/js/styles.73bcda62.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.9ec563a4.js" as="script">
<link rel="preload" href="/assets/js/main.eae8cb57.js" as="script">
<link rel="preload" href="/assets/js/1.f1d9a196.js" as="script">
<link rel="preload" href="/assets/js/2.56558908.js" as="script">
<link rel="preload" href="/assets/js/6875c492.b6a41606.js" as="script">
<link rel="preload" href="/assets/js/7a85f91c.9d42c7fd.js" as="script">
<link rel="preload" href="/assets/js/a3bc796e.5f1aeb9f.js" as="script">
<link rel="preload" href="/assets/js/ef31134d.15675d55.js" as="script">
<link rel="preload" href="/assets/js/4d3ea989.090ca89c.js" as="script">
<link rel="preload" href="/assets/js/f4af9f40.4a253d99.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Jamie McCrindle</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://twitter.com/foldr" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter</a><div class="react-toggle react-toggle--checked react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" checked="" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Jamie McCrindle</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/">Blog</a></li><li class="menu__list-item"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://twitter.com/foldr" target="_blank" rel="noopener noreferrer" class="menu__link">Twitter</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/azure-app-service-devcontainer">Running a devcontainer in an Azure App Service</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/azure-bicep-app-service-custom-container">Building an Azure App Service with a customer container using Bicep</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/github-actions-schedule-to-delete-resources-from-resource-group">Keep your Azure Costs low by removing dev resources from resource groups on a schedule.</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/rotating-azure-credentials-in-github-with-terraform">How to rotate your AZURE_CREDENTIALS in GitHub with Terraform</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/how-to-install-a-specific-version-of-terraform-github-actions-using-apt-get">Install a specific version of Terraform in a Github Action using apt</a></li></ul></div></div><main class="col col--7"><h1>3 posts tagged with &quot;github&quot;</h1><a href="/tags">View All Tags</a><div class="margin-vert--xl"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/github-actions-schedule-to-delete-resources-from-resource-group">Keep your Azure Costs low by removing dev resources from resource groups on a schedule.</a></h2><div class="margin-vert--md"><time datetime="2021-05-30T00:00:00.000Z" class="blogPostDate_fNvV">May 30, 2021 Â· 2 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/909696?s=60&amp;v=4" alt="Jamie McCrindle"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer">Jamie McCrindle</a></h4><small class="avatar__subtitle">foldr</small></div></div></header><div class="markdown"><p>I have a Visual Studio subscription that gives me Â£40.00 of Azure Credit each month to experiment in Azure. I find it relatively easy to spend this if I&#x27;m not careful about deleting resources after I&#x27;ve spun them up. Fortunately, I can use a GitHub Actions workflow on a schedule to save me when I forget.</p><p>I usually associate a set of resource groups with a repository in GitHub. I have a couple of options, I could delete the resource groups themselves or I could delete the resources in the resource groups. In this example, I&#x27;ve chosen just to delete the resources.</p><p>To do this, I use <code>complete</code> mode with an empty ARM template:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;$schema&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;contentVersion&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;1.0.0.0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;resources&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The GitHub Action then looks as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> destroy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">schedule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">cron</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0 0 * * *&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># add workflow dispatch to be able to run trigger the workflow manually</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">workflow_dispatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">jobs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">destroy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">runs-on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">latest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Azure Login</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> azure/login@v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">with</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">creds</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> secrets.AZURE_CREDENTIALS </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> actions/checkout@v2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Destroy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> deploy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">acr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> azure/CLI@v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">with</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">azcliversion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 2.23.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">inlineScript</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">          az deployment group create --name destroy --resource-group NAME_OF_YOUR_RESOURCE_GROUP --template-file .github/workflows/empty.json --mode Complete</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Check out the the following repo for a working example: <a href="https://github.com/jamiemccrindle/bicep-app-service-container" target="_blank" rel="noopener noreferrer">https://github.com/jamiemccrindle/bicep-app-service-container</a></p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/azure">azure</a><a class="margin-horiz--sm" href="/tags/github">github</a><a class="margin-horiz--sm" href="/tags/github-actions">github-actions</a></div><div class="col text--right"><a aria-label="Read more about Keep your Azure Costs low by removing dev resources from resource groups on a schedule." href="/github-actions-schedule-to-delete-resources-from-resource-group"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/rotating-azure-credentials-in-github-with-terraform">How to rotate your AZURE_CREDENTIALS in GitHub with Terraform</a></h2><div class="margin-vert--md"><time datetime="2021-04-28T00:00:00.000Z" class="blogPostDate_fNvV">April 28, 2021 Â· 3 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/909696?s=60&amp;v=4" alt="Jamie McCrindle"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer">Jamie McCrindle</a></h4><small class="avatar__subtitle">foldr</small></div></div></header><div class="markdown"><p>If you&#x27;re deploying your Azure infrastructure from GitHub, you&#x27;ll need Azure service principal credentials stored as secret variables.
You may also want to rotate those credentials. This entry describes how you can use Terraform in your GitHub actions to configure
and rotate your Azure service principal credentials.</p><p>In a <a href="https://foldr.uk/terraform-rotate-secrets" target="_blank" rel="noopener noreferrer">previous post, I describe how to safely rotate credentials using Terraform</a>. This post
builds on that by showing you how to create client secrets for your Azure service principals and store them as secrets in GitHub.</p><p>First off, we&#x27;ll create a Terraform module that will manage the secret rotation in Azure and GitHub. This stores everything you need
to be able to deploy from GitHub to Azure, including information about the credentials, service principal, tenant and subscription.</p><p>It stores them both as an AZURE_CREDENTIALS json block that matches the output of <code>az ad sp create-for-rbac --sdk-auth</code> which is
useful for the <a href="https://github.com/marketplace/actions/azure-login" target="_blank" rel="noopener noreferrer">Azure Login GitHub Action</a> under the variable AZURE_CREDENTIALS
as well as broken out into ARM_CLIENT_ID, ARM_TENANT_ID, ARM_SUBSCRIPTION_ID and ARM_CLIENT_SECRET which is useful for running
Terraform in GitHub Actions.</p><p>The format of the sdk-auth that the Azure Login GitHub Action requires is as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;clientId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;APPLICATION_ID&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;clientSecret&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;CLIENT_SECRET&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;subscriptionId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SUBSCRIPTION_ID&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;tenantId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;TENANT_ID&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;activeDirectoryEndpointUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://login.microsoftonline.com&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;resourceManagerEndpointUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://management.azure.com/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;activeDirectoryGraphResourceId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://graph.windows.net/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;sqlManagementEndpointUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://management.core.windows.net:8443/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;galleryEndpointUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://gallery.azure.com/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;managementEndpointUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://management.core.windows.net/&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The following files will create a Terraform module that will allow you to safely rotate secrets in Azure and store the currently
active secret in GitHub secrets for use in GitHub Actions:</p><p><code>provider.tf</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><div tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">provider &quot;azurerm&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  features {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>variables.tf</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><div tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;subscription_id&quot; { type = string }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;tenant_id&quot; { type = string }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;repository&quot; { type = string }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;application_id&quot; { type = string }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;application_object_id&quot; { type = string }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;date&quot; { type = string }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>main.tf</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><div tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">locals {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  date        = tonumber(var.date)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  odd_keeper  = floor((local.date + 1) / 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  even_keeper = floor(local.date / 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  use_even    = local.date % 2 == 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;random_uuid&quot; &quot;odd&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;azuread_application_password&quot; &quot;odd&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  application_object_id = var.application_object_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description           = &quot;odd&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  value                 = random_password.odd.result</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end_date_relative     = &quot;1440h&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  key_id                = random_uuid.odd.result</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;random_password&quot; &quot;odd&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  keepers = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;date&quot; = local.odd_keeper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  length  = 64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;random_uuid&quot; &quot;even&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;azuread_application_password&quot; &quot;even&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  application_object_id = var.application_object_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description           = &quot;even&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  value                 = random_password.even.result</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end_date_relative     = &quot;1440h&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  key_id                = random_uuid.even.result</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;random_password&quot; &quot;even&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  keepers = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;date&quot; = local.even_keeper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  length  = 64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;github_actions_secret&quot; &quot;terraform&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  repository      = var.repository</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name     = &quot;AZURE_CREDENTIALS&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  plaintext_value = &lt;&lt;-EOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;clientId&quot;: &quot;${var.application_id}&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;clientSecret&quot;: &quot;${local.use_even ? random_password.even.result : random_password.odd.result}&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;subscriptionId&quot;: &quot;${var.subscription_id}&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;tenantId&quot;: &quot;${var.tenant_id}&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;activeDirectoryEndpointUrl&quot;: &quot;https://login.microsoftonline.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;resourceManagerEndpointUrl&quot;: &quot;https://management.azure.com/&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;activeDirectoryGraphResourceId&quot;: &quot;https://graph.windows.net/&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;sqlManagementEndpointUrl&quot;: &quot;https://management.core.windows.net:8443/&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;galleryEndpointUrl&quot;: &quot;https://gallery.azure.com/&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;managementEndpointUrl&quot;: &quot;https://management.core.windows.net/&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;github_actions_secret&quot; &quot;arm_client_id&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  repository = var.repository</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name = &quot;ARM_CLIENT_ID&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  plaintext_value = var.application_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;github_actions_secret&quot; &quot;arm_client_secret&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  repository = var.repository</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name = &quot;ARM_CLIENT_SECRET&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  plaintext_value = local.use_even ? random_password.even.result : random_password.odd.result</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;github_actions_secret&quot; &quot;arm_subscription_id&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  repository = var.repository</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name = &quot;ARM_SUBSCRIPTION_ID&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  plaintext_value = var.subscription_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;github_actions_secret&quot; &quot;arm_tenant_id&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  repository = var.repository</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name = &quot;ARM_TENANT_ID&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  plaintext_value = var.tenant_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-the-module"></a>Using the module<a class="hash-link" href="#using-the-module" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><div tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">module &quot;example_github_azure&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  source                = &quot;LOCATION_OF_MODULE&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  subscription_id       = AZURE_SUBSCRIPTION_ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  tenant_id             = AZURE_TENANT_ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  repository            = GITHUB_REPO_NAME</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  application_id        = AZURE_APPLICATION_ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  application_object_id = AZURE_APPLICATION_OBJECT_ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  date                  = var.date</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To see it in action, have a look at this repository <a href="https://github.com/jamiemccrindle/azure-rotate-service-principal-github-secrets" target="_blank" rel="noopener noreferrer">https://github.com/jamiemccrindle/azure-rotate-service-principal-github-secrets</a></p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/terraform">terraform</a><a class="margin-horiz--sm" href="/tags/azure">azure</a><a class="margin-horiz--sm" href="/tags/github">github</a></div><div class="col text--right"><a aria-label="Read more about How to rotate your AZURE_CREDENTIALS in GitHub with Terraform" href="/rotating-azure-credentials-in-github-with-terraform"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/how-to-install-a-specific-version-of-terraform-github-actions-using-apt-get">Install a specific version of Terraform in a Github Action using apt</a></h2><div class="margin-vert--md"><time datetime="2021-04-20T00:00:00.000Z" class="blogPostDate_fNvV">April 20, 2021 Â· One min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/909696?s=60&amp;v=4" alt="Jamie McCrindle"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer">Jamie McCrindle</a></h4><small class="avatar__subtitle">foldr</small></div></div></header><div class="markdown"><p>The standard way to install Terraform on ubuntu is via <code>apt</code> but the instructions typically don&#x27;t show how to
select a specific version. Most examples of how to install a specific version of terraform in a GitHub action
just pull the binary directly.</p><p>This is how you can install a specific version of Terraform for use in a GitHub action using <code>apt</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> install</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">terraform</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">example</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">branches</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">jobs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">install-terraform</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">runs-on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">latest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        sudo apt-add-repository &quot;deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        sudo apt-get update</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        sudo apt-get install terraform=0.14.10</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/terraform">terraform</a><a class="margin-horiz--sm" href="/tags/github">github</a></div><div class="col text--right"><a aria-label="Read more about Install a specific version of Terraform in a Github Action using apt" href="/how-to-install-a-specific-version-of-terraform-github-actions-using-apt-get"><strong>Read More</strong></a></div></footer></article></div></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Socials</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/foldr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://jamie.mccrindle.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">jamie.mccrindle.org</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Jamie McCrindle. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.73bcda62.js"></script>
<script src="/assets/js/runtime~main.9ec563a4.js"></script>
<script src="/assets/js/main.eae8cb57.js"></script>
<script src="/assets/js/1.f1d9a196.js"></script>
<script src="/assets/js/2.56558908.js"></script>
<script src="/assets/js/6875c492.b6a41606.js"></script>
<script src="/assets/js/7a85f91c.9d42c7fd.js"></script>
<script src="/assets/js/a3bc796e.5f1aeb9f.js"></script>
<script src="/assets/js/ef31134d.15675d55.js"></script>
<script src="/assets/js/4d3ea989.090ca89c.js"></script>
<script src="/assets/js/f4af9f40.4a253d99.js"></script>
</body>
</html>