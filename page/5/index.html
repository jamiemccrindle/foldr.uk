<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Jamie McCrindle Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Jamie McCrindle Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-GZL9B6CNB7","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Jamie McCrindle | Jamie McCrindle</title><meta data-react-helmet="true" property="og:title" content="Jamie McCrindle | Jamie McCrindle"><meta data-react-helmet="true" name="description" content="A programming blog"><meta data-react-helmet="true" property="og:description" content="A programming blog"><meta data-react-helmet="true" property="og:url" content="https://foldr.uk/page/5"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_posts_list"><link data-react-helmet="true" rel="shortcut icon" href="/img/logo.jpeg"><link data-react-helmet="true" rel="canonical" href="https://foldr.uk/page/5"><link data-react-helmet="true" rel="alternate" href="https://foldr.uk/page/5" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://foldr.uk/page/5" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.e3f1fff0.css">
<link rel="preload" href="/assets/js/runtime~main.d5fcaed6.js" as="script">
<link rel="preload" href="/assets/js/main.711a1e15.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Jamie McCrindle</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://twitter.com/foldr" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--checked react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.jpeg" alt="Jamie McCrindle Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Jamie McCrindle</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/">Blog</a></li><li class="menu__list-item"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://twitter.com/foldr" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/exploiting-visual-studio-code-devcontainers">Exploiting Visual Studio Code Devcontainers</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/azure-app-service-devcontainer">Running a devcontainer in an Azure App Service</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/azure-bicep-app-service-custom-container">Building an Azure App Service with a custom container using Bicep</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/github-actions-schedule-to-delete-resources-from-resource-group">Keep your Azure Costs low by removing dev resources from resource groups on a schedule.</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/rotating-azure-credentials-in-github-with-terraform">How to rotate your AZURE_CREDENTIALS in GitHub with Terraform</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/how-to-install-a-specific-version-of-terraform-github-actions-using-apt-get">Install a specific version of Terraform in a Github Action using apt</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/microsoft-graph-terraform-data-source">Microsoft Graph API Terraform Data Source</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/bootstrap-terraform-state-in-azure">Bootstrap terraform state in azure</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/terraform-rotate-secrets">Safely rotate secrets with terraform</a></li></ul></nav></aside><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="blogPostTitle_GeHD"><a href="/rotating-azure-credentials-in-github-with-terraform">How to rotate your AZURE_CREDENTIALS in GitHub with Terraform</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-04-28T00:00:00.000Z">April 28, 2021</time> Â· 3 min read</div><div class="avatar margin-vert--md"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/909696?s=60&amp;v=4" alt="Jamie McCrindle"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer">Jamie McCrindle</a></div><small class="avatar__subtitle">foldr</small></div></div></header><div class="markdown"><p>If you&#x27;re deploying your Azure infrastructure from GitHub, you&#x27;ll need Azure service principal credentials stored as secret variables.
You may also want to rotate those credentials. This entry describes how you can use Terraform in your GitHub actions to configure
and rotate your Azure service principal credentials.</p><p>In a <a href="https://foldr.uk/terraform-rotate-secrets" target="_blank" rel="noopener noreferrer">previous post, I describe how to safely rotate credentials using Terraform</a>. This post
builds on that by showing you how to create client secrets for your Azure service principals and store them as secrets in GitHub.</p><p>First off, we&#x27;ll create a Terraform module that will manage the secret rotation in Azure and GitHub. This stores everything you need
to be able to deploy from GitHub to Azure, including information about the credentials, service principal, tenant and subscription.</p><p>It stores them both as an AZURE_CREDENTIALS json block that matches the output of <code>az ad sp create-for-rbac --sdk-auth</code> which is
useful for the <a href="https://github.com/marketplace/actions/azure-login" target="_blank" rel="noopener noreferrer">Azure Login GitHub Action</a> under the variable AZURE_CREDENTIALS
as well as broken out into ARM_CLIENT_ID, ARM_TENANT_ID, ARM_SUBSCRIPTION_ID and ARM_CLIENT_SECRET which is useful for running
Terraform in GitHub Actions.</p><p>The format of the sdk-auth that the Azure Login GitHub Action requires is as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;clientId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;APPLICATION_ID&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;clientSecret&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;CLIENT_SECRET&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;subscriptionId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SUBSCRIPTION_ID&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;tenantId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;TENANT_ID&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;activeDirectoryEndpointUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://login.microsoftonline.com&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;resourceManagerEndpointUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://management.azure.com/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;activeDirectoryGraphResourceId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://graph.windows.net/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;sqlManagementEndpointUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://management.core.windows.net:8443/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;galleryEndpointUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://gallery.azure.com/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;managementEndpointUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://management.core.windows.net/&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The following files will create a Terraform module that will allow you to safely rotate secrets in Azure and store the currently
active secret in GitHub secrets for use in GitHub Actions:</p><p><code>provider.tf</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">provider &quot;azurerm&quot; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  features {}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>variables.tf</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;subscription_id&quot; { type = string }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;tenant_id&quot; { type = string }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;repository&quot; { type = string }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;application_id&quot; { type = string }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;application_object_id&quot; { type = string }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;date&quot; { type = string }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>main.tf</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">locals {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  date        = tonumber(var.date)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  odd_keeper  = floor((local.date + 1) / 2)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  even_keeper = floor(local.date / 2)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  use_even    = local.date % 2 == 0</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;random_uuid&quot; &quot;odd&quot; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;azuread_application_password&quot; &quot;odd&quot; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  application_object_id = var.application_object_id</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  description           = &quot;odd&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  value                 = random_password.odd.result</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  end_date_relative     = &quot;1440h&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  key_id                = random_uuid.odd.result</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;random_password&quot; &quot;odd&quot; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  keepers = {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;date&quot; = local.odd_keeper</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  length  = 64</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;random_uuid&quot; &quot;even&quot; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;azuread_application_password&quot; &quot;even&quot; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  application_object_id = var.application_object_id</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  description           = &quot;even&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  value                 = random_password.even.result</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  end_date_relative     = &quot;1440h&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  key_id                = random_uuid.even.result</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;random_password&quot; &quot;even&quot; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  keepers = {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;date&quot; = local.even_keeper</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  length  = 64</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;github_actions_secret&quot; &quot;terraform&quot; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  repository      = var.repository</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name     = &quot;AZURE_CREDENTIALS&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  plaintext_value = &lt;&lt;-EOT</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;clientId&quot;: &quot;${var.application_id}&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;clientSecret&quot;: &quot;${local.use_even ? random_password.even.result : random_password.odd.result}&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;subscriptionId&quot;: &quot;${var.subscription_id}&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;tenantId&quot;: &quot;${var.tenant_id}&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;activeDirectoryEndpointUrl&quot;: &quot;https://login.microsoftonline.com&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;resourceManagerEndpointUrl&quot;: &quot;https://management.azure.com/&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;activeDirectoryGraphResourceId&quot;: &quot;https://graph.windows.net/&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;sqlManagementEndpointUrl&quot;: &quot;https://management.core.windows.net:8443/&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;galleryEndpointUrl&quot;: &quot;https://gallery.azure.com/&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;managementEndpointUrl&quot;: &quot;https://management.core.windows.net/&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOT</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;github_actions_secret&quot; &quot;arm_client_id&quot; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  repository = var.repository</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name = &quot;ARM_CLIENT_ID&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  plaintext_value = var.application_id</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;github_actions_secret&quot; &quot;arm_client_secret&quot; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  repository = var.repository</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name = &quot;ARM_CLIENT_SECRET&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  plaintext_value = local.use_even ? random_password.even.result : random_password.odd.result</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;github_actions_secret&quot; &quot;arm_subscription_id&quot; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  repository = var.repository</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name = &quot;ARM_SUBSCRIPTION_ID&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  plaintext_value = var.subscription_id</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;github_actions_secret&quot; &quot;arm_tenant_id&quot; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  repository = var.repository</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name = &quot;ARM_TENANT_ID&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  plaintext_value = var.tenant_id</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-the-module"></a>Using the module<a class="hash-link" href="#using-the-module" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">module &quot;example_github_azure&quot; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  source                = &quot;LOCATION_OF_MODULE&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  subscription_id       = AZURE_SUBSCRIPTION_ID</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  tenant_id             = AZURE_TENANT_ID</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  repository            = GITHUB_REPO_NAME</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  application_id        = AZURE_APPLICATION_ID</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  application_object_id = AZURE_APPLICATION_OBJECT_ID</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  date                  = var.date</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To see it in action, have a look at this repository <a href="https://github.com/jamiemccrindle/azure-rotate-service-principal-github-secrets" target="_blank" rel="noopener noreferrer">https://github.com/jamiemccrindle/azure-rotate-service-principal-github-secrets</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/tags/terraform">terraform</a><a class="margin-horiz--sm" href="/tags/azure">azure</a><a class="margin-horiz--sm" href="/tags/github">github</a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/page/4"><div class="pagination-nav__label">Â« Newer Entries</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/page/6"><div class="pagination-nav__label">Older Entries Â»</div></a></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Socials</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/foldr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://github.com/jamiemccrindle" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://jamie.mccrindle.org" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>jamie.mccrindle.org<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Jamie McCrindle. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d5fcaed6.js"></script>
<script src="/assets/js/main.711a1e15.js"></script>
</body>
</html>